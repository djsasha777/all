<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>VISUAL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 20px; 
            background: #111; 
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        #gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 1600px;
            margin: 0 auto;
        }
        img {
            width: 100%; 
            height: 240px;
            object-fit: cover; 
            cursor: pointer;
            /* ‚úÖ –£–ë–†–ê–ù–´ –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏—è */
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        img:hover { 
            transform: scale(1.05); 
            border-color: #4a90e2;
            box-shadow: 0 8px 25px rgba(74,144,226,0.4);
        }
        #modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 999;
            padding: 20px;
        }
        #modal img {
            max-width: 98vw;
            max-height: 98vh;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            /* ‚úÖ –£–ë–†–ê–ù–û –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
            box-shadow: 0 0 60px rgba(255,255,255,0.1);
        }
        .error {
            grid-column: 1/-1;
            color: #ff6b6b;
            background: rgba(255,107,107,0.1);
            padding: 30px;
            text-align: center;
            border-radius: 12px;
            border: 2px solid #ff6b6b;
            font-size: 18px;
        }
        @media (max-width: 1400px) { #gallery { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1000px) { #gallery { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 700px) { 
            #gallery { grid-template-columns: 1fr; }
            img { height: 300px; }
        }
    </style>
</head>
<body>
    <!-- ‚úÖ –£–ë–†–ê–ù –∑–∞–≥–æ–ª–æ–≤–æ–∫ VISUAL -->
    <div id="gallery"></div>
    <div id="modal"><img id="modal-img"></div>

    <script>
        const BASE_PATH = '/mnt/nvme0n1/nfs/VISUAL';
        const gallery = document.getElementById('gallery');
        
        async function init() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...');
                
                const res = await fetch(`${BASE_PATH}/`, { 
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                const html = await res.text();
                console.log('üìÑ HTML –ø–æ–ª—É—á–µ–Ω');
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const links = Array.from(doc.querySelectorAll('a[href]'))
                    .map(a => a.getAttribute('href'))
                    .filter(href => href && href.match(/\.(jpe?g|png|gif|webp|bmp|tiff)$/i))
                    .filter(href => !href.includes('..'))
                    .map(href => `${BASE_PATH}/${href}`);
                
                console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${links.length}`);
                
                if (links.length === 0) {
                    gallery.innerHTML = '<div class="error">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏.</div>';
                    return;
                }
                
                // ‚úÖ –ù–ò–ó–ö–û–ö–ê–ß–ï–°–¢–í–ï–ù–ù–´–ï –º–∏–Ω–∏–∞—Ç—é—Ä—ã –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                gallery.innerHTML = links.map(src => {
                    const thumbSrc = `${src}?w=300&q=30&t=${Date.now()}`; // 300px, 30% –∫–∞—á–µ—Å—Ç–≤–æ
                    return `<img src="${thumbSrc}" 
                              loading="lazy"
                              onerror="this.style.display='none'"
                              onclick="openModal('${src.replace(/'/g, '\\\'')}')">`;
                }).join('');
                
            } catch(error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                gallery.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }
        
        function openModal(src) {
            const modal = document.getElementById('modal');
            const modalImg = document.getElementById('modal-img');
            modal.style.display = 'block';
            modalImg.src = src + '?t=' + Date.now(); // ‚úÖ –ü–û–õ–ù–û–ï –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –º–æ–¥–∞–ª–∫–∏
            document.body.style.overflow = 'hidden';
            console.log('üñºÔ∏è –û—Ç–∫—Ä—ã—Ç–æ:', src);
        }
        
        document.getElementById('modal').onclick = (e) => {
            if (e.target.id === 'modal') {
                document.getElementById('modal').style.display = 'none';
                document.body.style.overflow = '';
            }
        };
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.getElementById('modal').style.display = 'none';
                document.body.style.overflow = '';
            }
        });
        
        window.addEventListener('load', init);
    </script>
</body>
</html>
